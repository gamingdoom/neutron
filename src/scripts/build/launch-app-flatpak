#!/bin/bash

set -euo pipefail

if [ -d src/launch-app/build ]; then
	rm -rf src/launch-app/build
fi
mkdir src/launch-app/build
pushd src/launch-app/build
	CC=clang CXX=clang++ cmake \
		-DCMAKE_BUILD_TYPE=Release \
		.. \
		-DAPPLICATION_NAME=\"NEUTRON_INTERNAL_APP_NAME\" \
		-DSHOULD_OPEN_IN_DEFAULT_BROWSER=NEUTRON_OPEN_IN_DEFAULT_BROWSER \
		-DSHOULD_RUN_IN_BACKGROUND=NEUTRON_SHOULD_RUN_IN_BACKGROUND 

	cmake --build .
	cp launch-app ../../launch-app.flatpak
popd

cp src/launch-app.flatpak NEUTRON_INTERNAL_APP_NAME-linux/NEUTRON_INTERNAL_APP_NAME-linux/launch-app