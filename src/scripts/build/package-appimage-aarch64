#!/bin/bash

set -euo pipefail

shopt -s extglob

if [ -d  NEUTRON_INTERNAL_APP_NAME.AppImage ]; then
    rm -r NEUTRON_INTERNAL_APP_NAME.AppImage
fi

cp -r src/packages/appimage/neutron.AppImage NEUTRON_INTERNAL_APP_NAME.AppImage
mv NEUTRON_INTERNAL_APP_NAME.AppImage/neutron.desktop NEUTRON_INTERNAL_APP_NAME.AppImage/NEUTRON_INTERNAL_APP_NAME.desktop
mkdir -p NEUTRON_INTERNAL_APP_NAME.AppImage/usr/lib/NEUTRON_INTERNAL_APP_NAME
tar --strip-components=1 -xvf  datcord-linux-aarch64.tar.@(bz2|xz) -C NEUTRON_INTERNAL_APP_NAME.AppImage/usr/lib/NEUTRON_INTERNAL_APP_NAME/
cp -r src/distribution/ NEUTRON_INTERNAL_APP_NAME.AppImage/usr/lib/NEUTRON_INTERNAL_APP_NAME/
mv NEUTRON_INTERNAL_APP_NAME.AppImage/usr/lib/NEUTRON_INTERNAL_APP_NAME/distribution/policies-linux-appimage.json NEUTRON_INTERNAL_APP_NAME.AppImage/usr/lib/NEUTRON_INTERNAL_APP_NAME/distribution/policies.json 
cp src/open-in-default-browser/open-in-default-browser NEUTRON_INTERNAL_APP_NAME.AppImage/usr/lib/NEUTRON_INTERNAL_APP_NAME/

ARCH=arm_aarch64 appimagetool NEUTRON_INTERNAL_APP_NAME.AppImage/
